#pragma config(Sensor, S2,     US,             sensorEV3_Ultrasonic)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#define THRESHOLD		90

void turn(float speed);
void drive(float speed);
void stopRobot();

enum States {
	SEARCHING,
	REFINING,
	MOVING,
}

void refine_angle()
{
	int min_distance, new_distance;
	min_distance = getUSDistance(US);
	turn(0.1);
	while(1)
	{
		new_distance = getUSDistance(US);
		if (new_distance < min_distance) {
			break;
		}
	}
}

task main()
{
	int distance = 0;

	// Target search protocol

	turn(20);

	while(1)
	{
		while(1)
		{
			distance = getUSDistance(US);
			if (distance < THRESHOLD)
			{
				displayCenteredBigTextLine(4, "Target Aquired");
				stopRobot();
				drive();
				break;
			}
			else {
				displayCenteredBigTextLine(4, "Searching");
			}
		}
		while(1)
		{
			distance = getUSDistance(US);
			if (distance > THRESHOLD)
			{
				displayCenteredBigTextLine(4, "Target Lost");
				stopRobot();
				turn(20);
				break;
			}
			else {
				displayCenteredBigTextLine(4, "Moving");
			}
		}
	}
}